<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Caqti_query_fmt (caqti.Caqti_query_fmt)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.1"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../index.html">caqti</a> &#x00BB; Caqti_query_fmt</nav><header class="odoc-preamble"><h1>Module <code><span>Caqti_query_fmt</span></code></h1><p>Format-based query construction.</p></header><nav class="odoc-toc"><ul><li><a href="#value-formatters">Value Formatters</a></li></ul></nav><div class="odoc-content"><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a t</span></span><span> = <span><span class="xref-unresolved">Stdlib</span>.Format.formatter <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>The type of a function which formats values of type <code>'a</code> or fragments based on an input of type <code>'a</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-qprintf"><a href="#val-qprintf" class="anchor"></a><code><span><span class="keyword">val</span> qprintf : 
  <span><span><span>(<span class="type-var">'a</span>, <span class="xref-unresolved">Stdlib</span>.Format.formatter, unit, <a href="../Caqti_query/index.html#type-t">Caqti_query.t</a>)</span> <span class="xref-unresolved">Stdlib</span>.format4</span> <span class="arrow">&#45;&gt;</span></span>
  <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p><a href="#val-qprintf"><code>qprintf</code></a> allows building Caqti queries using a printf-style interface.</p><p>When using <a href="#val-qprintf"><code>qprintf</code></a>, you can use the <a href="#val-query"><code>query</code></a>, <a href="#val-quote"><code>quote</code></a>, <a href="#val-env"><code>env</code></a> and <a href="#val-param"><code>param</code></a> printers from this module to generate the corresponding query fragments.</p><p>In addition, you can use the &quot;Q&quot; and &quot;E&quot; string tags to delimit portions of the formatting string that should be interpreted as quotes and environment variables, respectively. The &quot;Q&quot; and &quot;E&quot; tags can not be nested: within the tags, <a href="#val-qprintf"><code>qprintf</code></a> behaves no differently than <code>Format.asprintf</code> and will generate a string, not a query (only when the tag is closed does the string get converted into a query).</p><p>The two following calls to <a href="#val-qprintf"><code>qprintf</code></a>:</p><pre class="language-ocaml"><code>qprintf &quot;FUNC(@{&lt;Q&gt;Quoted value with %d format(s)})&quot; 1</code></pre><p>and</p><pre class="language-ocaml"><code>qprintf &quot;FUNC(%a)&quot; quote (Format.asprintf &quot;Quoted value with %d format(s)&quot; 1)</code></pre><p>are functionally equivalent. Both compute</p><pre class="language-ocaml"><code>S [L &quot;FUNC(&quot;; Q &quot;Quoted value with 1 format(s)&quot;; L &quot;)&quot;]</code></pre><p>but the first one is nicer to work with.</p><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <code>Failure</code> <p>if the &quot;Q&quot; and &quot;E&quot; tags are nested.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-kqprintf"><a href="#val-kqprintf" class="anchor"></a><code><span><span class="keyword">val</span> kqprintf : 
  <span><span>(<span><a href="../Caqti_query/index.html#type-t">Caqti_query.t</a> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'b</span>, <span class="xref-unresolved">Stdlib</span>.Format.formatter, unit, <span class="type-var">'a</span>)</span> <span class="xref-unresolved">Stdlib</span>.format4</span> <span class="arrow">&#45;&gt;</span></span>
  <span class="type-var">'b</span></span></code></div><div class="spec-doc"><p><a href="#val-kqprintf"><code>kqprintf</code></a> is the continuation-passing version of <a href="#val-qprintf"><code>qprintf</code></a> (like <code>Format.kasprintf</code> for <code>Format.asprintf</code>).</p><p>You usually want <code>qprintf</code> instead.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-param"><a href="#val-param" class="anchor"></a><code><span><span class="keyword">val</span> param : <span>int <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><a href="#val-param"><code>param</code></a> is a formatter that includes the corresponding parameter in a query built by <a href="#val-qprintf"><code>qprintf</code></a>.</p><p>Note that to include a parameter in a query, <a href="#val-param"><code>param</code></a> *must* be used: using literal <code>&quot;$&quot;</code> or <code>&quot;?&quot;</code> will be sent as-is to the SQL driver and will not be processed by Caqti.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-env"><a href="#val-env" class="anchor"></a><code><span><span class="keyword">val</span> env : <span>string <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><a href="#val-env"><code>env</code></a> is a formatter that includes the corresponding environment variable in a query built by <a href="#val-qprintf"><code>qprintf</code></a>.</p><p>Note that to include an environment variable in a query, <a href="#val-env"><code>env</code></a> *must* be used: using literal <code>&quot;$(...)&quot;</code> will be sent as-is to the SQL driver and will not be processed by Caqti.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-quote"><a href="#val-quote" class="anchor"></a><code><span><span class="keyword">val</span> quote : <span>string <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><a href="#val-quote"><code>quote</code></a> is a formatter that includes a TEXT literal in a query built by <a href="#val-qprintf"><code>qprintf</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-query"><a href="#val-query" class="anchor"></a><code><span><span class="keyword">val</span> query : <span><a href="../Caqti_query/index.html#type-t">Caqti_query.t</a> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><a href="#val-query"><code>query</code></a> can be used with <a href="#val-qprintf"><code>qprintf</code></a> to embed a query that was already parsed in the format string. Direct use of <a href="#val-query"><code>query</code></a> should be rare, and <a href="#val-param"><code>param</code></a>, <a href="#val-env"><code>env</code></a>, or <a href="#val-quote"><code>quote</code></a> should be used instead when possible.</p><p>Using <a href="#val-query"><code>query</code></a> with any other formatter will ignore the query and instead print a dummy value (currently <code>&quot;... SQL FRAGMENT ...&quot;</code>) instead.</p></div></div><h3 id="value-formatters"><a href="#value-formatters" class="anchor"></a>Value Formatters</h3><p>The following formatters emit values of basic field types by passing them as parameters. This is done by emitting a <a href="../Caqti_query/index.html#type-t.V"><code>Caqti_query.t.V</code></a> node with a appropriate field type.</p><div class="odoc-spec"><div class="spec value anchored" id="val-bool"><a href="#val-bool" class="anchor"></a><code><span><span class="keyword">val</span> bool : <span>bool <a href="#type-t">t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-int"><a href="#val-int" class="anchor"></a><code><span><span class="keyword">val</span> int : <span>int <a href="#type-t">t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-float"><a href="#val-float" class="anchor"></a><code><span><span class="keyword">val</span> float : <span>float <a href="#type-t">t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-string"><a href="#val-string" class="anchor"></a><code><span><span class="keyword">val</span> string : <span>string <a href="#type-t">t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-octets"><a href="#val-octets" class="anchor"></a><code><span><span class="keyword">val</span> octets : <span>string <a href="#type-t">t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pdate"><a href="#val-pdate" class="anchor"></a><code><span><span class="keyword">val</span> pdate : <span><span class="xref-unresolved">Ptime</span>.t <a href="#type-t">t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-ptime"><a href="#val-ptime" class="anchor"></a><code><span><span class="keyword">val</span> ptime : <span><span class="xref-unresolved">Ptime</span>.t <a href="#type-t">t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-ptime_span"><a href="#val-ptime_span" class="anchor"></a><code><span><span class="keyword">val</span> ptime_span : <span><span class="xref-unresolved">Ptime</span>.span <a href="#type-t">t</a></span></span></code></div></div></div></body></html>
